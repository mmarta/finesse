if(window.Finesse&&Finesse.isFromNYJAMMAArcadeEngine);else{if(window.Finesse&&!Finesse.isFromNYJAMMAArcadeEngine)throw"FinesseError: Can't include another Finesse library here not from NY JAMMA Arcade Engine.";!function(e){var t={isFromNYJAMMAArcadeEngine:!0};t.UPDATE_MODE_UNINITIALIZED=-1,t.UPDATE_MODE_SCREEN_SYNC=0,t.UPDATE_MODE_TIMEOUT=1,t.UPDATE_MODE_SAFE=t.UPDATE_MODE_TIMEOUT,t.updateMode=-1,t.frameWaitLeft=0,t.registerUpdateMode=function(r){switch(r){case t.UPDATE_MODE_SCREEN_SYNC:return e.requestAnimationFrame?(t.updateMode=r,!0):!1;case t.UPDATE_MODE_SAFE:return t.updateMode=r,!0;default:return!1}};var r=function(){t.frameWaitLeft--,0==t.frameWaitLeft?t.runFunction():t.waitNextFrame()};t.waitNextFrame=function(e){switch(e||(e=0==t.frameWaitLeft?1:t.frameWaitLeft),t.frameWaitLeft=e,t.updateMode){case t.UPDATE_MODE_SCREEN_SYNC:requestAnimationFrame(r);break;case t.UPDATE_MODE_SAFE:setTimeout(r,17)}},t.runPogramLoop=function(e){switch(t.updateMode){case t.UPDATE_MODE_SCREEN_SYNC:case t.UPDATE_MODE_SAFE:t.runFunction=function(){e()},t.runFunction();break;default:throw"FinesseError: No update mode has been registered."}},t.DISPLAY_MODE_STANDARD=0,t.DISPLAY_MODE_SIMULATE_FULLSCREEN=1,t.createPageDisplay=function(e,t){var r=document.createElement("canvas");if(!r)return null;var n=document.createElement("canvas");return r.width=e,r.height=t,r.style.position="relative",n.width=e,n.height=t,{displayCanvas:r,bufferCanvas:n,display2DContext:r.getContext("2d"),buffer2DContext:n.getContext("2d"),baseLocation:null,width:e,height:t,ratio:1,backgroundLayers:{}}},t.retrieveDrawableContext=function(e){return e.buffer2DContext},t.renderPageDisplay=function(e){e.display2DContext.drawImage(e.bufferCanvas,0,0)},t.addPageDisplayToElement=function(e,r){var n,o=e.displayCanvas;n="string"!=typeof r?r:document.getElementById(r),null!=e.displayMode&&e.displayMode!=t.DISPLAY_MODE_STANDARD&&o.remove(),n.appendChild(o),e.baseLocation=n,e.displayMode=t.DISPLAY_MODE_STANDARD},t.simulateFullScreenPageDisplay=function(e){var r=e.baseLocation,n=e.displayCanvas;null!=r&&n.remove(),e.displayMode=t.DISPLAY_MODE_SIMULATE_FULLSCREEN,t.resizeSimulatedFullScreenPageDisplay(e),document.body.appendChild(n)},t.resizeSimulatedFullScreenPageDisplay=function(r){var n,o,a,i,s,d,u,l,c=r.displayCanvas,E=c.style;if(r.displayMode==t.DISPLAY_MODE_SIMULATE_FULLSCREEN){if(void 0==e.innerWidth)throw"FinesseError: This browser uses non-standard window methods. Can't use simulated full screen.";n=e.innerWidth,o=e.innerHeight,a=n/o,l=r.width/r.height,a>l?(s=o,i=o*l>>0,u=0,d=n-i>>1,r.ratio=o/r.height):(i=n,s=n/l>>0,d=0,u=o-s>>1,r.ratio=n/r.width),E.position="fixed",E.top=u+"px",E.left=d+"px",E.width=i+"px",E.height=s+"px"}},t.returnToStandardPageDisplay=function(e){var r=e.baseLocation,n=e.displayCanvas,o=n.style;if(o.position="relative",o.top=null,o.left=null,o.width=null,o.height=null,n.remove(),e.ratio=1,null==r)throw"FinesseError: This display has not been added to an element to return to standard display mode.";r.appendChild(n),e.displayMode=t.DISPLAY_MODE_STANDARD},t.drawFullImageToPageDisplay=function(e,t,r,n){e.buffer2DContext.drawImage(t,x,y)},t.drawSpriteToPageDisplay=function(e,t,r,n,o,a,i,s){e.buffer2DContext.drawImage(t,r,n,i,s,o,a,i,s)},t.drawScaledSpriteToPageDisplay=function(e,t,r,n,o,a,i,s,d,u){e.buffer2DContext.drawImage(t,r,n,o,a,i,s,d,u)},t.drawPixelToPageDisplay=function(e,r,n,o){t.drawBoxToPageDisplay(e,r,n,1,1,o)},t.drawBoxToPageDisplay=function(e,t,r,n,o,a){var i=e.buffer2DContext;i.fillStyle=a,i.fillRect(t,r,n,o)},t.createRGBColorHexString=function(e,t,r){return"#"+(16>e?"0"+e.toString(16):e.toString(16))+(16>t?"0"+t.toString(16):t.toString(16))+(16>r?"0"+r.toString(16):r.toString(16))},t.clearDisplayPage=function(e,t){var r=e.buffer2DContext,n=e.bufferCanvas;t||(t="#000000"),r.fillStyle=t,r.fillRect(0,0,n.width,n.height)},t.BACKGROUND_LAYER_TILED_TYPE=0,t.BACKGROUND_LAYER_FULL_TYPE=1,t.registerTiledBackgroundLayer=function(e,r,n,o,a,i,s,d){var u={data:o,image:n,tileSize:a,repeat:d,type:t.BACKGROUND_LAYER_TILED_TYPE,x:0,y:0,tileCols:i,tileRows:s,width:i*a,height:s*a};if(e.backgroundLayers[r])throw'FinesseError: A background layer already exists for key "'+r+'"';e.backgroundLayers[r]=u},t.registerFullBackgroundLayer=function(e,r,n,o){var a={image:n,repeat:o,type:t.BACKGROUND_LAYER_FULL_TYPE,x:0,y:0,width:n.width,height:n.height};if(e.backgroundLayers[r])throw'FinesseError: A background layer already exists for key "'+r+'"';e.backgroundLayers[r]=a},t.scrollBackground=function(e,t,r,n){var o=e.backgroundLayers[t],a=o.width,i=o.height,s=e.width,d=e.height;if(!o)throw"FinesseError: This layer does not exist.";if(r+s>a||n+d>i){if(!o.repeat)throw"FinesseError: Your background scrolling is out of bounds. If you want a repeating background, please set repeat to true."}else if(0>r||0>n)throw"FinesseError: Your background scrolling can't be less than 0, even in repeated backgrounds.";r>a&&(r%=a),n+d>i&&(n%=i),o.x=0-r,o.y=0-n},t.drawBackgroundLayer=function(e,r){var n,o,a,i,s,d=e.backgroundLayers[r],u=e.buffer2DContext,l=d.data,c=d.image,E=d.tileSize;if(tileCols=d.tileCols,tileRows=d.tileRows,w=d.width,h=d.height,dW=e.width,dH=e.height,!d)throw"FinesseError: This layer does not exist.";if(d.type==t.BACKGROUND_LAYER_TILED_TYPE)if(a=d.x,i=d.y,d.repeat)for(n=0;!0;n++){for(o=0;!0&&(a>0-E&&i>0-E&&a<e.width&&i<e.height&&(s=o*tileCols+n,u.drawImage(c,l[s][0]*E,l[s][1]*E,E,E,a,i,E,E)),i+=E,!(i>=dH));o++)o>=tileRows-1&&(o=-1);if(a+=E,i=d.y,a>=dW)break;n>=tileCols-1&&(n=-1)}else for(n=0;n<tileCols;n++){for(o=0;o<tileRows;o++)a>0-E&&i>0-E&&a<e.width&&i<e.height&&(s=o*tileCols+n,u.drawImage(c,l[s][0]*E,l[s][1]*E,E,E,a,i,E,E)),a+=E;i+=E,a=d.x}else if(d.repeat)for(a=d.x,i=d.y;;){for(;;)if(u.drawImage(c,0,0,w,h,a,i,w,h),i+=h,i>=dH)break;if(a+=w,i=d.y,a>=dW)break}else a=-1*d.x,i=-1*d.y,u.drawImage(c,a,i,w,h,0,0,w,h)},t.removeBackgroundLayer=function(e,t){delete e.backgroundLayers[t]},t.registerKeyboard=function(){for(var r=256,n=new Array(r);r--;)n[r]=!1;try{e.addEventListener("keydown",function(e){n[e.keyCode]=!0}),e.addEventListener("keyup",function(e){n[e.keyCode]=!1})}catch(o){throw"FinesseError: This browser does not support modern event listeners."}t.keys=n},t.registerGameControllers=function(){try{navigator.getGamepads()}catch(e){throw"FinesseError: This browser does not support game controllers."}t.gameControllersRegistered=!0},t.pollGameControllers=function(){if(!t.gameControllersRegistered)throw"FinesseError: Game controllers have not been registered";t.gameControllers=navigator.getGamepads()},t.getGameControllerAxis=function(e,r){if(!t.gameControllersRegistered)throw"FinesseError: Game controllers have not been registered.";try{return t.gameControllers[e].axes[r]}catch(n){return 0}},t.getGameControllerButton=function(e,r){if(!t.gameControllersRegistered)throw"FinesseError: Game controllers have not been registered.";try{return t.gameControllers[e].buttons[r].pressed}catch(n){return!1}},t.registerMouseOnElement=function(e){try{var t={x:-1,y:-1,buttons:[!1,!1,!1,!1,!1,!1,!1,!1]};return e.addEventListener("mousemove",function(e){t.x=e.offsetX,t.y=e.offsetY}),e.addEventListener("mouseout",function(e){t.x=-1,t.y=-1}),e.addEventListener("mousedown",function(e){e.preventDefault(),t.buttons[e.button]=!0}),e.addEventListener("mouseup",function(e){e.preventDefault(),t.buttons[e.button]=!1}),t}catch(r){throw"FinesseError: This browser does not support modern event listeners."}},t.registerMouseOnPageDisplay=function(e){return t.registerMouseOnElement(e.displayCanvas)},t.registerVirtualMouseOnPageDisplay=function(e){try{var t=e.displayCanvas,r={x:-1,y:-1,buttons:[!1,!1,!1,!1,!1,!1,!1,!1]};return t.addEventListener("mousemove",function(t){var n=e.ratio;r.x=t.offsetX/n>>0,r.y=t.offsetY/n>>0}),t.addEventListener("mouseout",function(e){r.x=-1,r.y=-1}),t.addEventListener("mousedown",function(e){e.preventDefault(),r.buttons[e.button]=!0}),t.addEventListener("mouseup",function(e){e.preventDefault(),r.buttons[e.button]=!1}),r}catch(n){throw"FinesseError: This browser does not support modern event listeners."}},t.registerTouchOnElement=function(e){try{var t={touches:[{x:-1,y:-1},{x:-1,y:-1},{x:-1,y:-1},{x:-1,y:-1}]},r=function(e){var r=e.touches,n=t.touches,o=0;for(o=0;4>o;o++)r[o]?(n[o].x=r[o].clientX-display1.displayCanvas.offsetLeft>>0,n[o].y=r[o].clientY-display1.displayCanvas.offsetTop>>0):(n[o].x=-1,n[o].y=-1)};return e.addEventListener("touchstart",r),e.addEventListener("touchmove",r),e.addEventListener("touchend",r),t}catch(n){throw"FinesseError: This browser does not support modern event listeners."}},t.registerTouchOnPageDisplay=function(e){return t.registerTouchOnElement(e.displayCanvas)},t.registerVirtualTouchOnPageDisplay=function(e){try{var t=e.displayCanvas,r={touches:[{x:-1,y:-1},{x:-1,y:-1},{x:-1,y:-1},{x:-1,y:-1}]},n=function(t){var n=t.touches,o=r.touches,a=e.ratio,i=0;for(t.preventDefault(),i=0;4>i;i++)n[i]?(o[i].x=(n[i].clientX-display1.displayCanvas.offsetLeft)/a>>0,o[i].y=(n[i].clientY-display1.displayCanvas.offsetTop)/a>>0):(o[i].x=-1,o[i].y=-1)};return t.addEventListener("touchstart",n),t.addEventListener("touchmove",n),t.addEventListener("touchend",n),r}catch(o){throw"FinesseError: This browser does not support modern event listeners."}},t.AUDIO_TYPE_UNINITIALIZED=-1,t.AUDIO_TYPE_NONE=0,t.AUDIO_TYPE_ELEMENT=1,t.AUDIO_TYPE_WEB_AUDIO=2,t.audioType=t.AUDIO_TYPE_UNINITIALIZED,t.audioSystemContext=void 0,t.registerAudio=function(){var r=e.AudioContext||e.webkitAudioContext;if(r){var n=new r;n.createGain();t.audioSystemContext=n,t.audioType=t.AUDIO_TYPE_WEB_AUDIO}else document.createElement("audio")?t.audioType=t.AUDIO_TYPE_ELEMENT:t.audioType=t.AUDIO_TYPE_UNINITIALIZED},t.loadAudioFile=function(e,r){var n=t.audioType;switch(n){case t.AUDIO_TYPE_NONE:throw"FinesseError: There is no audio available in this browser.";case t.AUDIO_TYPE_ELEMENT:var o=document.createElement("audio");try{o.addEventListener("canplay",r,!1)}catch(a){throw"FinesseError: This browser does not support modern event listeners."}o.src=e;var i={element:o};return i;case t.AUDIO_TYPE_WEB_AUDIO:var s=new XMLHttpRequest,d=t.audioSystemContext,i={isPlaying:!1};s.open("GET",e,!0),s.responseType="arraybuffer";try{s.onload=function(){d.decodeAudioData(s.response,function(e){i.bufferData=e,r&&r()},function(){throw"FinesseError: Could not load audio."})},s.send()}catch(a){throw"FinesseError: This browser does not support modern event listeners."}return i;default:throw"FinesseError: There is no audio initialized."}},t.playAudio=function(e,r,n,o){var a=t.audioType;switch(a){case t.AUDIO_TYPE_NONE:throw"FinesseError: There is no audio available in this browser.";case t.AUDIO_TYPE_ELEMENT:var i=e.element;void 0!==n?i.volume=n:i.volume=1,void 0!==r?i.loop=r:i.loop=!1,i.currentTime=0,i.pause(),i.currentTime=0,i.play();break;case t.AUDIO_TYPE_WEB_AUDIO:var s=t.audioSystemContext,d=s.createBufferSource(),u=s.createGain(),l=s.createStereoPanner();e.isPlaying&&t.stopAudio(e),d.buffer=e.bufferData,d.connect(u),u.connect(l),l.connect(s.destination),void 0!==n?u.gain.value=n:u.gain.value=1,void 0!==o?l.pan.value=o:l.pan.value=0,void 0!==r?d.loop=r:d.loop=!1,d.addEventListener("ended",function(){e.isPlaying=!1},!1),d.start?d.start(0):d.noteOn(0),e.isPlaying=!0,e.nodeSource=d,e.gainNode=u,e.panNode=l;break;default:throw"FinesseError: There is no audio initialized."}},t.stopAudio=function(e){var r=t.audioType;switch(r){case t.AUDIO_TYPE_NONE:throw"FinesseError: There is no audio available in this browser.";case t.AUDIO_TYPE_ELEMENT:var n=e.element;n.pause(),n.currentTime=0;break;case t.AUDIO_TYPE_WEB_AUDIO:var o=e.nodeSource;o&&(o.stop?o.stop(0):o.noteOff(0)),e.isPlaying=!1;break;default:throw"FinesseError: There is no audio initialized."}},t.setAudioVolume=function(e,r){var n=t.audioType;switch(n){case t.AUDIO_TYPE_NONE:throw"FinesseError: There is no audio available in this browser.";case t.AUDIO_TYPE_ELEMENT:var o=e.element;o.volume=r;break;case t.AUDIO_TYPE_WEB_AUDIO:e.gainNode.gain.value=r;break;default:throw"FinesseError: There is no audio initialized."}},t.setAudioPan=function(e,r){var n=t.audioType;switch(n){case t.AUDIO_TYPE_NONE:throw"FinesseError: There is no audio available in this browser.";case t.AUDIO_TYPE_ELEMENT:break;case t.AUDIO_TYPE_WEB_AUDIO:e.panNode.pan.value=r;break;default:throw"FinesseError: There is no audio initialized."}},e.Finesse=t}(window)}